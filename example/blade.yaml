#
# Global configuration for all services
#

- name: *
  watch:
    fs:
      ignore:
        - node_modules
        - .*
        - "**/*_test.go"
  inheritEnv: true
  env:
    - name: GLOBAL_VAR_1
      value: GLOBAL_VAL_1
  output:
    stdout: os
    stderr: os

#
# Individual service configurations
#

- name: service-one
  tags:
    - service
  watch:
    fs:
      path: cmd/service-one/
  env:
    - name: VAR_1
      value: VAL_1
    - name: VAR_2
      value: VAL_2
    - name: VAR_NO_VALUE
    - name: VAR_EMPTY
    - name: PATH
    - name: PWD
    - name: GOCACHE
    - name: HOME
      value:
  before: echo "do something at first run"
  run: go run cmd/service-one/main.go

- name: service-two
  tags:
    - service
  env:
    - name: VAR_3
      value: VAL_3
    - name: VAR_4
      value: VAL_4
    - name: VAR_NO_VALUE
    - name: VAR_EMPTY_QUOTE
      value: ""
  watch:
    fs:
      paths:
        - cmd/service-two/main.go
  run: go run cmd/service-two/main.go

- name: random-exit
  tags:
    - service
    - random
  run: go run cmd/random-exit/main.go

- name: random-panic
  tags:
    - service
    - random
  run: go run cmd/random-panic/main.go

- name: sigterm-duo
  skip: true
  run: go run cmd/sigterm-duo/main.go

- name: update-loop
  watch:
    fs:
      paths:
        - cmd/update-loop
  run: go run cmd/update-loop/main.go
